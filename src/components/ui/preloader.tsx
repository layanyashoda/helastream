"use client";

import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { useRef, useState, useEffect } from "react";

export default function Preloader() {
    const [show, setShow] = useState(true);
    const containerRef = useRef(null);
    const logoRef = useRef(null);

    useGSAP(() => {
        const tl = gsap.timeline({
            onComplete: () => setShow(false),
        });

        // Initial State
        gsap.set(logoRef.current, { opacity: 0, scale: 0.5 });

        // Animation Sequence
        tl.to(logoRef.current, {
            opacity: 1,
            scale: 1,
            duration: 0.8,
            ease: "back.out(1.7)",
        })
            .to(logoRef.current, {
                scale: 1.1,
                duration: 0.5,
                yoyo: true,
                repeat: 1,
                ease: "sine.inOut"
            })
            .to(logoRef.current, {
                opacity: 0,
                scale: 1.5,
                duration: 0.5,
                ease: "power2.in"
            }, "+=0.2")
            .to(containerRef.current, {
                yPercent: -100,
                duration: 0.7,
                ease: "power2.inOut"
            });

    }, { scope: containerRef });

    // Prevent scrolling while preloader is active
    useEffect(() => {
        if (show) {
            document.body.style.overflow = "hidden";
        } else {
            document.body.style.overflow = "unset";
        }
    }, [show]);

    if (!show) return null;

    return (
        <div
            ref={containerRef}
            className="fixed inset-0 z-[9999] bg-[#141519] flex items-center justify-center pointer-events-none"
        >
            <div ref={logoRef} className="text-center">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 460 96"
                    className="w-64 md:w-96 h-auto overflow-visible"
                    fill="none"
                >
                    {/* Reused paths from HeaderLogoLarge */}
                    <path
                        className="fill-[#FF0000]"
                        d="m55.34,0H20C8.96,0,0,8.96,0,20v35.34c0,11.05,8.96,20,20,20h35.34c11.05,0,20-8.96,20-20V20c0-11.05-8.96-20-20-20Zm-27.35,53.03v-30.71l26.59,15.35-26.59,15.35Z"
                    />
                    <g className="fill-white">
                        <path d="m116.09,27.51c13.47,0,20.05,6.59,19.76,19.76v8.55c0,7.25-1.76,12.36-5.27,15.32-3.52,2.96-9.9,4.44-19.15,4.44s-15.54-1.48-19.09-4.44c-3.55-2.96-5.33-8.06-5.33-15.32V22.29c0-14.58,7.33-21.72,21.98-21.42h20.98v14.1h-19.09c-3.18,0-5.31.5-6.38,1.5-1.07,1-1.61,3.02-1.61,6.05v29.86c0,3.63.57,6.05,1.72,7.27,1.15,1.22,3.42,1.83,6.83,1.83s5.77-.61,6.88-1.83c1.11-1.22,1.67-3.64,1.67-7.27v-3.66c0-2.37-.41-3.96-1.22-4.77-.82-.81-2.44-1.22-4.88-1.22h-5.22v-15.21h7.44Z" />
                        <path d="m196.45.65c13.25,0,19.83,6.03,19.76,18.09v40.74c0,5.7-1.18,9.86-3.55,12.49-2.37,2.63-6.18,3.94-11.43,3.94-1.11,0-2.05-.06-2.83-.17-.78-.11-1.61-.28-2.5-.5v-13.43c1.78,0,2.96-.33,3.55-1,.59-.67.89-2,.89-4V18.74c0-1.63-.3-2.72-.89-3.27-.59-.55-1.67-.83-3.22-.83h-.11c-1.63,0-2.81.3-3.55.89-.74.59-1.41,1.7-2,3.33l-5.11,12.99c3.55,1.04,5.33,5.77,5.33,14.21v6.22c0,8.73-1.68,14.8-5.05,18.2-3.37,3.4-9.27,5.11-17.7,5.11s-14.49-1.68-17.93-5.05c-3.44-3.37-5.16-9.08-5.16-17.15v-13.65c0-8.36,2.11-13.8,6.33-16.32v-2.33c0-2.81-.43-4.53-1.28-5.16-.85-.63-2.54-.94-5.05-.94h-2.22V.87h4.88c6.95,0,11.95,1.52,14.98,4.55,3.03,3.04,4.55,8.03,4.55,14.98v14.21h-.33c-2.37,0-3.96.41-4.77,1.22-.82.81-1.22,2.48-1.22,5v14.76c0,2.29.48,3.85,1.44,4.66.96.81,2.81,1.22,5.55,1.22s4.7-.41,5.66-1.22c.96-.81,1.44-2.37,1.44-4.66v-9.44c0-1.85-.32-3.2-.94-4.05-.63-.85-1.87-1.28-3.72-1.28v-14.1l4.44-12.21c1.63-4.73,4.14-8.23,7.55-10.49,3.4-2.26,8.03-3.39,13.88-3.39h.33Z" />
                        <path d="m292.25,25.51v23.42c0,13.54-7.21,20.2-21.65,19.98h-1.44c-14.06,0-20.98-6.66-20.76-19.98v-6.1c0-2,.67-3.85,2-5.55h-5.99v-14.1h25.86v14.1h-2.22c-1.41,0-2.39.37-2.94,1.11-.55.74-.83,1.78-.83,3.11v7.21c0,2.29.41,3.88,1.22,4.77.81.89,2.33,1.33,4.55,1.33,2.44,0,4.11-.44,5-1.33s1.33-2.48,1.33-4.77v-22.31c0-4.22-.93-7.23-2.78-9.05-1.85-1.81-4.88-2.72-9.1-2.72h-13.21c-4.22,0-7.25.91-9.1,2.72-1.85,1.81-2.77,4.83-2.77,9.05v44.84c0,4.22.92,7.23,2.77,9.05,1.85,1.81,4.88,2.72,9.1,2.72h38.74v14.1h-38.74c-9.25,0-16.19-2.04-20.81-6.1-4.63-4.07-6.94-10.66-6.94-19.76V26.4c0-9.1,2.31-15.69,6.94-19.76,4.62-4.07,11.56-6.1,20.81-6.1h13.21c9.03,0,15.87,1.98,20.54,5.94,4.66,3.96,7.07,10.31,7.21,19.04Z" />
                        <path d="m343.01.79v13.95h-13.41v60.4h-16.31V14.73h-13.41V.79h43.13Z" />
                        <path d="m379.27,75.13h-18.67L344.08.79h16.09l5.58,28.43c1.93,9.8,3.33,18.67,4.18,26.61.93-8.3,2.32-17.17,4.18-26.61l5.58-28.43h16.09l-16.52,74.34Z" />
                        <path d="m446.32,31.04v13.95h-15.34v14.59h-15.02v-14.59h-15.34v-13.95h15.34v-14.59h15.02v14.59h15.34Z" />
                    </g>
                </svg>
            </div>
        </div>
    );
}
